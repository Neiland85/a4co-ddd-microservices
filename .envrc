# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸŒ A4CO DEV ENVIRONMENT (.envrc PRO)
# Autor: Neil MuÃ±oz Lago
# Proyecto: a4co-ddd-microservices
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Seguridad: detener carga si no es el proyecto correcto
if [[ "$(basename "$PWD")" != "a4co-ddd-microservices" ]]; then
  echo "âš ï¸  Direnv: No estÃ¡s en el entorno A4CO, cancelando carga."
  exit 0
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”§ Variables de entorno base
export PROJECT_ROOT="$(pwd)"
export PROJECT_NAME="a4co-ddd-microservices"
export NODE_ENV="development"
export AWS_REGION="eu-west-1"

# Paths locales
export PATH="$PROJECT_ROOT/.local-bin:$PROJECT_ROOT/node_modules/.bin:$PATH"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ³ Docker / DevContainer detection
if command -v docker &>/dev/null; then
  echo "ğŸ‹ Docker disponible â†’ $(docker --version | awk '{print $3}' | tr -d ',')"
else
  echo "âš ï¸  Docker no encontrado. Algunas funciones no estarÃ¡n disponibles."
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§  Tools Info
if command -v node &>/dev/null; then
  echo "ğŸŸ¢ NodeJS â†’ $(node -v)"
fi
if command -v pnpm &>/dev/null; then
  echo "ğŸ“¦ pnpm â†’ $(pnpm -v)"
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸš€ Alias exclusivos del entorno
alias a4co-status='echo "ğŸ“ Proyecto: $PROJECT_NAME  |  Entorno: $NODE_ENV  |  RegiÃ³n: $AWS_REGION"'
alias a4co-containers='docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"'

# Ejecutar auto-setup al entrar (solo si el contenedor estÃ¡ activo)
if docker ps --format '{{.Names}}' | grep -q "devcontainer-dev-1"; then
  echo "ğŸ” Contenedor detectado: ejecutando setup automatizado..."
  bash .devcontainer/init-scripts/setup.sh
else
  echo "ğŸ’¤ Contenedor no activo (setup omitido). Usa 'a4co-setup' manualmente."
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§© Mensaje final
echo "âœ… Entorno cargado para $PROJECT_NAME"
echo "   ğŸ“ Ruta: $PROJECT_ROOT"
echo "   ğŸ§° PATH extendido con .local-bin y node_modules"

