---
name: Design System Preview

on:
  pull_request:
    paths:
      - 'packages/design-system/**'
      - '.github/workflows/design-system-preview.yml'
  push:
    branches:
      - main
      - develop
    paths:
      - 'packages/design-system/**'

jobs:
  build-and-preview:
    name: Build and Deploy Preview
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        run: |
          git clone --depth 1 --branch ${{ github.ref_name }} https://x-access-token:${{ github.token }}@github.com/${{ github.repository }}.git .
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Setup Node.js
        run: |
          node --version
          npm --version

      - name: Setup pnpm
        run: |
          npm install -g pnpm@8
          pnpm --version

      - name: Install dependencies
        run: pnpm install --no-frozen-lockfile

      - name: Build design system
        run: pnpm --filter @a4co/design-system build

      - name: Build Storybook
        run: pnpm --filter @a4co/design-system storybook:build

      - name: Deploy preview
        run: |
          echo "Design system preview built successfully!"
          echo "Storybook build completed"
