openapi: 3.0.3
info:
  title: A4CO Order Service API
  description: Order Management and Processing Service for A4CO Platform
  version: 1.0.0
  contact:
    name: A4CO Development Team
    email: dev@a4co.com

servers:
  - url: http://localhost:3004/api/v1/orders
    description: Development server
  - url: https://api.a4co.com/orders
    description: Production server

paths:
  /:
    get:
      summary: List orders
      description: Get a paginated list of orders for the authenticated user
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of items per page
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, processing, shipped, delivered, cancelled]
          description: Filter by order status
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, updatedAt, totalAmount]
            default: createdAt
          description: Sort field
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized

    post:
      summary: Create order
      description: Create a new order from cart items
      tags:
        - Orders
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Validation error or insufficient inventory
        '401':
          description: Unauthorized

  /{orderId}:
    get:
      summary: Get order by ID
      description: Get detailed information about a specific order
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: Order ID
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found

    put:
      summary: Update order
      description: Update order information (limited operations allowed)
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderRequest'
      responses:
        '200':
          description: Order updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found

  /{orderId}/cancel:
    post:
      summary: Cancel order
      description: Cancel an order (if still in cancellable state)
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: Order ID
      responses:
        '200':
          description: Order cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Order cannot be cancelled
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found

  /{orderId}/status:
    put:
      summary: Update order status
      description: Update order status (admin/artisan only)
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderStatusRequest'
      responses:
        '200':
          description: Order status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Invalid status transition
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found

  /admin:
    get:
      summary: List all orders (admin)
      description: Get a paginated list of all orders (admin only)
      tags:
        - Admin
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of items per page
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, processing, shipped, delivered, cancelled]
          description: Filter by order status
        - name: customerId
          in: query
          schema:
            type: string
          description: Filter by customer ID
        - name: artisanId
          in: query
          schema:
            type: string
          description: Filter by artisan ID
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date
          description: Filter orders from date
        - name: dateTo
          in: query
          schema:
            type: string
            format: date
          description: Filter orders to date
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

components:
  schemas:
    Order:
      type: object
      properties:
        id:
          type: string
          example: 'order-123'
        customerId:
          type: string
          example: 'user-456'
        customer:
          $ref: '#/components/schemas/Customer'
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        status:
          type: string
          enum: [pending, confirmed, processing, shipped, delivered, cancelled]
          example: 'confirmed'
        totalAmount:
          type: number
          format: float
          minimum: 0
          example: 179.98
        currency:
          type: string
          example: 'EUR'
        shippingAddress:
          $ref: '#/components/schemas/Address'
        billingAddress:
          $ref: '#/components/schemas/Address'
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'
        shippingMethod:
          type: string
          example: 'standard'
        trackingNumber:
          type: string
          nullable: true
          example: 'TRK123456789'
        notes:
          type: string
          nullable: true
          example: 'Please handle with care'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T00:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-01T00:00:00Z'
        cancelledAt:
          type: string
          format: date-time
          nullable: true
          example: null

    OrderItem:
      type: object
      properties:
        id:
          type: string
          example: 'item-123'
        productId:
          type: string
          example: 'product-789'
        product:
          $ref: '#/components/schemas/Product'
        quantity:
          type: integer
          minimum: 1
          example: 2
        unitPrice:
          type: number
          format: float
          minimum: 0
          example: 89.99
        totalPrice:
          type: number
          format: float
          minimum: 0
          example: 179.98
        artisanId:
          type: string
          example: 'user-101'

    Customer:
      type: object
      properties:
        id:
          type: string
          example: 'user-456'
        name:
          type: string
          example: 'Juan PÃ©rez'
        email:
          type: string
          format: email
          example: 'juan@example.com'

    Product:
      type: object
      properties:
        id:
          type: string
          example: 'product-789'
        name:
          type: string
          example: 'Handcrafted Ceramic Vase'
        image:
          type: string
          format: uri
          example: 'https://example.com/image.jpg'

    Address:
      type: object
      properties:
        street:
          type: string
          example: 'Calle Mayor 123'
        city:
          type: string
          example: 'Madrid'
        state:
          type: string
          example: 'Madrid'
        postalCode:
          type: string
          example: '28001'
        country:
          type: string
          example: 'Spain'

    PaymentMethod:
      type: object
      properties:
        type:
          type: string
          enum: [card, paypal, bank_transfer]
          example: 'card'
        last4:
          type: string
          example: '4242'
        brand:
          type: string
          example: 'visa'

    CreateOrderRequest:
      type: object
      required:
        - items
        - shippingAddress
        - billingAddress
      properties:
        items:
          type: array
          items:
            type: object
            required:
              - productId
              - quantity
            properties:
              productId:
                type: string
                example: 'product-789'
              quantity:
                type: integer
                minimum: 1
                example: 2
        shippingAddress:
          $ref: '#/components/schemas/Address'
        billingAddress:
          $ref: '#/components/schemas/Address'
        paymentMethodId:
          type: string
          example: 'pm_123456789'
        shippingMethod:
          type: string
          enum: [standard, express, pickup]
          default: 'standard'
          example: 'standard'
        notes:
          type: string
          maxLength: 500
          example: 'Please handle with care'

    UpdateOrderRequest:
      type: object
      properties:
        shippingAddress:
          $ref: '#/components/schemas/Address'
        billingAddress:
          $ref: '#/components/schemas/Address'
        notes:
          type: string
          maxLength: 500
          example: 'Updated delivery instructions'

    UpdateOrderStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [confirmed, processing, shipped, delivered, cancelled]
          example: 'shipped'
        trackingNumber:
          type: string
          example: 'TRK123456789'
        notes:
          type: string
          example: 'Package shipped via UPS'

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 100
        totalPages:
          type: integer
          example: 5

    Error:
      type: object
      properties:
        error:
          type: string
        code:
          type: string
        details:
          type: array
          items:
            type: string

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []
