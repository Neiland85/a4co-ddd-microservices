# =============================================================================
# A4CO Microservices Platform - Default Configuration
# =============================================================================

# Global configuration shared across all services
global:
  # Container registry configuration
  imageRegistry: ghcr.io
  imagePullSecrets:
    - name: ghcr-credentials
  
  # Environment identifier
  environment: production
  
  # Database configuration
  database:
    host: postgresql
    port: 5432
    name: a4co_prod
    ssl: true
  
  # Message broker configuration
  nats:
    host: nats
    port: 4222
    cluster: a4co-cluster
  
  # Cache configuration
  redis:
    host: redis-master
    port: 6379
    db: 0
  
  # Networking configuration
  domain: a4co.com
  tls:
    enabled: true
    issuer: letsencrypt-prod
  
  # Security
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000

# =============================================================================
# Microservices Configuration
# =============================================================================

# Order Service
orderService:
  enabled: true
  replicaCount: 3
  
  image:
    repository: neiland85/a4co-order-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  service:
    type: ClusterIP
    port: 3004
  
  env:
    NODE_ENV: production
    PORT: "3004"
    LOG_LEVEL: info
    SERVICE_NAME: order-service
  
  secrets:
    - a4co-jwt-secret
    - a4co-db-credentials
    - a4co-nats-credentials
  
  livenessProbe:
    httpGet:
      path: /health
      port: 3004
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 3004
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Payment Service
paymentService:
  enabled: true
  replicaCount: 3
  
  image:
    repository: neiland85/a4co-payment-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  service:
    type: ClusterIP
    port: 3006
  
  env:
    NODE_ENV: production
    PORT: "3006"
    LOG_LEVEL: info
    SERVICE_NAME: payment-service
  
  secrets:
    - a4co-jwt-secret
    - a4co-db-credentials
    - a4co-stripe-credentials
    - a4co-nats-credentials
  
  livenessProbe:
    httpGet:
      path: /health
      port: 3006
    initialDelaySeconds: 30
    periodSeconds: 10
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 3006
    initialDelaySeconds: 10
    periodSeconds: 5

# Inventory Service
inventoryService:
  enabled: true
  replicaCount: 2
  
  image:
    repository: neiland85/a4co-inventory-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 85
  
  service:
    type: ClusterIP
    port: 3007
  
  env:
    NODE_ENV: production
    PORT: "3007"
    LOG_LEVEL: info
    SERVICE_NAME: inventory-service
  
  secrets:
    - a4co-jwt-secret
    - a4co-db-credentials
    - a4co-nats-credentials
  
  livenessProbe:
    httpGet:
      path: /health
      port: 3007
    initialDelaySeconds: 30
    periodSeconds: 10
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 3007
    initialDelaySeconds: 10
    periodSeconds: 5

# Auth Service
authService:
  enabled: true
  replicaCount: 3
  
  image:
    repository: neiland85/a4co-auth-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  service:
    type: ClusterIP
    port: 3001
  
  env:
    NODE_ENV: production
    PORT: "3001"
    LOG_LEVEL: info
    SERVICE_NAME: auth-service
  
  secrets:
    - a4co-jwt-secret
    - a4co-db-credentials
    - a4co-oauth-credentials
  
  livenessProbe:
    httpGet:
      path: /health
      port: 3001
    initialDelaySeconds: 30
    periodSeconds: 10
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 3001
    initialDelaySeconds: 10
    periodSeconds: 5

# Product Service
productService:
  enabled: true
  replicaCount: 2
  
  image:
    repository: neiland85/a4co-product-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 150m
      memory: 256Mi
    limits:
      cpu: 750m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 85
  
  service:
    type: ClusterIP
    port: 3003
  
  env:
    NODE_ENV: production
    PORT: "3003"
    LOG_LEVEL: info
    SERVICE_NAME: product-service
  
  secrets:
    - a4co-jwt-secret
    - a4co-db-credentials
    - a4co-nats-credentials
  
  livenessProbe:
    httpGet:
      path: /health
      port: 3003
    initialDelaySeconds: 30
    periodSeconds: 10
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 3003
    initialDelaySeconds: 10
    periodSeconds: 5

# =============================================================================
# Infrastructure Dependencies
# =============================================================================

# PostgreSQL Database (Bitnami Chart)
postgresql:
  enabled: true
  
  auth:
    username: a4co_user
    database: a4co_prod
    existingSecret: a4co-db-credentials
    secretKeys:
      adminPasswordKey: postgres-password
      userPasswordKey: password
  
  primary:
    persistence:
      enabled: true
      size: 20Gi
      storageClass: "gp3"
    
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi
    
    initdb:
      scripts:
        init.sql: |
          -- Enable required extensions
          CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
          CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: a4co-observability

# NATS JetStream Message Broker
nats:
  enabled: true
  
  config:
    cluster:
      enabled: true
      replicas: 3
    
    jetstream:
      enabled: true
      memStorage:
        enabled: true
        size: 2Gi
      fileStorage:
        enabled: true
        size: 10Gi
        storageClassName: gp3
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  natsBox:
    enabled: true

# Redis Cache (Bitnami Chart)
redis:
  enabled: true
  
  architecture: replication
  
  auth:
    enabled: true
    existingSecret: a4co-redis-credentials
    existingSecretPasswordKey: password
  
  master:
    persistence:
      enabled: true
      size: 8Gi
      storageClass: gp3
    
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
  
  replica:
    replicaCount: 2
    
    persistence:
      enabled: true
      size: 8Gi
      storageClass: gp3
    
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
  
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

# =============================================================================
# Observability Stack
# =============================================================================

observability:
  enabled: true
  
  prometheus:
    enabled: true
    retention: 15d
    storageSize: 50Gi
  
  grafana:
    enabled: true
    adminPassword: changeme
  
  jaeger:
    enabled: true

# =============================================================================
# Ingress Configuration
# =============================================================================

ingress:
  enabled: true
  className: nginx
  
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/enable-cors: "true"
  
  hosts:
    - host: api.a4co.com
      paths:
        - path: /api/v1/auth
          pathType: Prefix
          service: authService
          port: 3001
        - path: /api/v1/products
          pathType: Prefix
          service: productService
          port: 3003
        - path: /api/v1/orders
          pathType: Prefix
          service: orderService
          port: 3004
        - path: /api/v1/payments
          pathType: Prefix
          service: paymentService
          port: 3006
        - path: /api/v1/inventory
          pathType: Prefix
          service: inventoryService
          port: 3007
  
  tls:
    - secretName: a4co-api-tls
      hosts:
        - api.a4co.com

# =============================================================================
# Security Configuration
# =============================================================================

networkPolicy:
  enabled: true
  
  # Allow traffic from ingress
  ingress:
    enabled: true
    from:
      - namespaceSelector:
          matchLabels:
            name: ingress-nginx

# External Secrets Operator
externalSecrets:
  enabled: true
  
  provider:
    aws:
      region: us-east-1
      service: SecretsManager
  
  secrets:
    - name: jwt
      key: a4co/production/jwt
    - name: database
      key: a4co/production/database
    - name: redis
      key: a4co/production/redis
    - name: stripe
      key: a4co/production/stripe
    - name: oauth
      key: a4co/production/oauth
    - name: nats
      key: a4co/production/nats

# Pod Disruption Budgets
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""
