# ADR-0013: Modelo de AnalÃ­tica y Observabilidad Unificada

ğŸ“… Fecha: 2025-07-14  
ğŸ‘¤ Autor: Neil MuÃ±oz Lago  
ğŸ”– Estado: Propuesta  
ğŸ” Reemplaza: â€”

---

## ğŸ¯ Contexto

Se necesita recolectar, visualizar y analizar datos crÃ­ticos sobre comportamiento de usuarios, mÃ©tricas de uso y rendimiento de servicios. Esto es clave para detectar cuellos de botella, fallos y validar decisiones de producto en OchioClub.

---

## âœ… DecisiÃ³n

- Se usarÃ¡ OpenTelemetry para recolectar mÃ©tricas y trazas de servicios NestJS.
- Los datos se enviarÃ¡n a Prometheus + Grafana (self-hosted) para monitoreo tÃ©cnico.
- Se almacenarÃ¡n mÃ©tricas clave de negocio (ventas, registros) en PostgreSQL y se visualizarÃ¡n en dashboards personalizados.
- Sentry se mantendrÃ¡ como sistema de captura de errores con alertas vÃ­a Slack.

---

## ğŸ”„ Alternativas consideradas

- âŒ Google Analytics (limitado y no self-hosted)
- âŒ Amplitude (licenciamiento externo, uso limitado en backend)
- âœ… OpenTelemetry + Grafana + PostgreSQL: trazabilidad completa y control total

---

## ğŸ§  Consecuencias

- ğŸŸ¢ Trazabilidad distribuida sin vendor lock-in
- ğŸŸ¢ Paneles personalizados para perfiles tÃ©cnicos y de negocio
- ğŸŸ¡ Requiere configuraciÃ³n de colectores y normalizaciÃ³n de eventos

---

## ğŸ§© Acciones asociadas

1. AÃ±adir OpenTelemetry SDK en todos los microservicios NestJS
2. Configurar colector y destino (Prometheus) con exporter oficial
3. Crear esquema de PostgreSQL para almacenar eventos clave de negocio
4. Crear dashboards de mÃ©tricas operativas y de conversiÃ³n

---

## ğŸ“ Referencias

- [OpenTelemetry NestJS docs](https://opentelemetry.io/docs/instrumentation/js/nestjs/)
- [docs/analytics-schema.sql](../docs/analytics-schema.sql)
- [ADR-0007: Seguridad y cumplimiento](./adr-0007-security-compliance.md)
