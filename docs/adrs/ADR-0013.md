# ADR-0013: Modelo de Analítica y Observabilidad Unificada

📅 Fecha: 2025-07-14  
👤 Autor: Neil Muñoz Lago  
🔖 Estado: Propuesta  
🔁 Reemplaza: —

---

## 🎯 Contexto

Se necesita recolectar, visualizar y analizar datos críticos sobre comportamiento de usuarios, métricas de uso y rendimiento de servicios. Esto es clave para detectar cuellos de botella, fallos y validar decisiones de producto en OchioClub.

---

## ✅ Decisión

- Se usará OpenTelemetry para recolectar métricas y trazas de servicios NestJS.
- Los datos se enviarán a Prometheus + Grafana (self-hosted) para monitoreo técnico.
- Se almacenarán métricas clave de negocio (ventas, registros) en PostgreSQL y se visualizarán en dashboards personalizados.
- Sentry se mantendrá como sistema de captura de errores con alertas vía Slack.

---

## 🔄 Alternativas consideradas

- ❌ Google Analytics (limitado y no self-hosted)
- ❌ Amplitude (licenciamiento externo, uso limitado en backend)
- ✅ OpenTelemetry + Grafana + PostgreSQL: trazabilidad completa y control total

---

## 🧠 Consecuencias

- 🟢 Trazabilidad distribuida sin vendor lock-in
- 🟢 Paneles personalizados para perfiles técnicos y de negocio
- 🟡 Requiere configuración de colectores y normalización de eventos

---

## 🧩 Acciones asociadas

1. Añadir OpenTelemetry SDK en todos los microservicios NestJS
2. Configurar colector y destino (Prometheus) con exporter oficial
3. Crear esquema de PostgreSQL para almacenar eventos clave de negocio
4. Crear dashboards de métricas operativas y de conversión

---

## 📎 Referencias

- [OpenTelemetry NestJS docs](https://opentelemetry.io/docs/instrumentation/js/nestjs/)
- [docs/analytics-schema.sql](../docs/analytics-schema.sql)
- [ADR-0007: Seguridad y cumplimiento](./adr-0007-security-compliance.md)
