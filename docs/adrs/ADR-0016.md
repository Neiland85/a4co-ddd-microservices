# ADR-0016: Estrategia de Build por Servicio

## Contexto

El monorepo utiliza TurboRepo para gestionar tareas como build, lint, test y otras operaciones. Sin embargo, para garantizar la escalabilidad y eficiencia, es necesario implementar una estrategia de build por servicio que optimice los tiempos de ejecución y facilite la integración continua.

## Decisión

Se adoptará una estrategia de build por servicio basada en los siguientes principios:

1. **Pipeline por Scope:** Cada servicio y paquete tendrá su propio pipeline de build definido en `turbo.json`.
2. **Dependencias Globales:** Las dependencias globales como `.env.*local` serán compartidas entre todos los servicios.
3. **Outputs Específicos:** Los outputs de cada tarea estarán claramente definidos para evitar conflictos y optimizar el cache.
4. **Persistencia en Desarrollo:** Las tareas de desarrollo (`dev`) serán persistentes y no utilizarán cache.

## Detalles de Implementación

### Configuración de TurboRepo

El archivo `turbo.json` incluye las siguientes tareas:

- **build:** Genera los artefactos necesarios para cada servicio.
- **lint:** Ejecuta análisis estático de código.
- **test:** Corre pruebas unitarias e integración.
- **clean:** Limpia artefactos generados.

### Ejemplo de Pipeline


```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**", ".next/**", "!.next/cache/**"]
    },
    "test": {
      "dependsOn": ["build"],
      "outputs": ["coverage/**"]
    }
  }
}

```


## Consecuencias

- **Beneficios:**
  - Reducción de tiempos de build.
  - Mejor organización y escalabilidad.
  - Facilita la integración continua.

- **Riesgos:**
  - Requiere mantenimiento constante de pipelines.
  - Posibles conflictos en dependencias globales.

## Estado

Adoptado.
